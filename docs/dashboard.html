<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
<script>
    // Alert function
    function showAlert(msg, color) {
        const container = document.getElementById('alertContainer');
        const div = document.createElement('div');
        div.className = `alert alert-${color} alert-dismissible fade show`;
        div.role = 'alert';
        div.innerHTML = `
            ${msg}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        `;
        container.appendChild(div);
        setTimeout(() => div.remove(), 2000);
    }

    // Toggle loading state
    function toggleLoading(showLoading) {
        const submitText = document.getElementById('submit-text');
        const loadingSpinner = document.getElementById('loading-spinner');
        const signInBtn = document.getElementById('sign_in');
        submitText.classList.toggle('d-none', showLoading);
        loadingSpinner.classList.toggle('d-none', !showLoading);
        signInBtn.disabled = showLoading;
    }

    // Form submission handler
    document.getElementById('signinForm').addEventListener('submit', (e) => {
        e.preventDefault();
        const form = e.target;

        if (!form.checkValidity()) {
            form.classList.add('was-validated');
            return;
        }

        const email = document.getElementById('email').value.trim();
        const password = document.getElementById('password').value;

        toggleLoading(true);

        // Check user in localStorage
        const users = JSON.parse(localStorage.getItem('users')) || {};
        const user = users[email];

        if (!user) {
            showAlert('No account found with this email', 'danger');
            toggleLoading(false);
            return;
        }

        if (user.Password !== password) {
            showAlert('Incorrect password', 'danger');
            toggleLoading(false);
            return;
        }

        // Set logged-in user
        localStorage.setItem('loggedInUser', email);

        showAlert('Sign in successful!', 'success');
        setTimeout(() => {
            window.location.href = './dashboard.html';
        }, 1000);
        toggleLoading(false);
    });

    // Google Sign-In (placeholder)
    document.getElementById('googleSignin').addEventListener('click', () => {
        showAlert('Google sign-in requires a backend service. Checking local storage...', 'warning');

        const users = JSON.parse(localStorage.getItem('users')) || {};
        const googleUser = Object.values(users).find(u => u.Email.startsWith('google_'));

        if (!googleUser) {
            showAlert('No Google account found. Please sign up first.', 'danger');
            return;
        }

        localStorage.setItem('loggedInUser', googleUser.Email);
        showAlert('Signed in with Google successfully!', 'success');
        setTimeout(() => {
            window.location.href = './dashboard.html';
        }, 1000);
    });

    // Facebook Sign-In (placeholder)
    document.getElementById('facebookSignin').addEventListener('click', () => {
        showAlert('Facebook sign-in requires a backend service. Checking local storage...', 'warning');

        const users = JSON.parse(localStorage.getItem('users')) || {};
        const fbUser = Object.values(users).find(u => u.Email.startsWith('fb_'));

        if (!fbUser) {
            showAlert('No Facebook account found. Please sign up first.', 'danger');
            return;
        }

        localStorage.setItem('loggedInUser', fbUser.Email);
        showAlert('Signed in with Facebook successfully!', 'success');
        setTimeout(() => {
            window.location.href = './dashboard.html';
        }, 1000);
    });
</script>